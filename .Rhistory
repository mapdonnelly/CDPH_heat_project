"+county:",
county,
"&key=f78d6b6c18608edc379b5a06c55407ceb45e7038",
sep = ""
)
))
ACSpop <- ACSpop[-1,]
colnames(ACSpop) <-
c(
"name",
"hisp_lat_race_total",
"not_hisp_lat_total",
"not_hisp_lat_white_alone",
"not_hisp_lat_black_af_am_alone",
"not_hisp_lat_am_ind_alone",
"not_hisp_lat_asian_alone",
"not_hisp_lat_nat_haw_pac_isl_alone",
"not_hisp_lat_some_other_alone",
"not_hisp_lat_two_or_more",
"not_hisp_lat_two_or_more_incl_some_other",
"not_hisp_lat_two_or_more_excl_some_other",
"yes_hisp_lat_total",
"yes_hisp_lat_white_alone",
"yes_hisp_lat_black_af_am_alone",
"yes_hisp_lat_am_ind_alone",
"yes_hisp_lat_asian_alone",
"yes_hisp_lat_nat_haw_pac_isl_alone",
"yes_hisp_lat_some_other_alone",
"yes_hisp_lat_two_or_more",
"yes_hisp_lat_two_or_more_incl_some_other",
"yes_hisp_lat_two_or_more_excl_some_other",
"state",
"county",
"tract"
)
#ACSpop <- ACSpop %>% gather(2:5,key = variable, value = value)
return(ACSpop)
}
counties<-unique(xwalk$COUNTY)
hisp_lat_race_list<-list()
for (i in 1:length(counties)) {
hisp_lat_race_list[[i]]<-getTractHispLatRace(state = 06,county = counties[i])
}
hisp_lat_race_df = do.call(rbind, hisp_lat_race_list)
###############
###Pop density
##############
state = 06
county = 01
getTractPopDens <- function(state, county) {
varString <-"B01003_001E"
# https://api.census.gov/data/2015/acs5?get=NAME,B01001_001E&for=county:013&in=state:02
ACSpop <-
as.data.frame(fromJSON(
paste(
"https://api.census.gov/data/2015/acs5?get=NAME,",
varString,
"&for=tract:*&in=state:",
state,
"+county:",
county,
"&key=f78d6b6c18608edc379b5a06c55407ceb45e7038",
sep = ""
)
))
ACSpop <- ACSpop[-1,]
colnames(ACSpop) <-
c(
"name",
"population_density",
"state",
"county",
"tract"
)
#ACSpop <- ACSpop %>% gather(2:5,key = variable, value = value)
return(ACSpop)
}
counties<-unique(xwalk$COUNTY)
pop_dens_list<-list()
for (i in 1:length(counties)) {
pop_dens_list[[i]]<-getTractPopDens(state = 06,county = counties[i])
}
pop_dens_df = do.call(rbind, pop_dens_list)
###############
###Household type including living alone pop >65
##############
state = 06
county = 01
getTractHouseholdType65 <- function(state, county) {
varString <-"B09020_001E,B09020_002E,B09020_003E,B09020_014E,B09020_015E,B09020_016E,B09020_017E,B09020_018E,B09020_019E,B09020_021E"
# https://api.census.gov/data/2015/acs5?get=NAME,B01001_001E&for=county:013&in=state:02
ACSpop <-
as.data.frame(fromJSON(
paste(
"https://api.census.gov/data/2015/acs5?get=NAME,",
varString,
"&for=tract:*&in=state:",
state,
"+county:",
county,
"&key=f78d6b6c18608edc379b5a06c55407ceb45e7038",
sep = ""
)
))
ACSpop <- ACSpop[-1,]
colnames(ACSpop) <-
c(
"name",
"household_type_over_65_total",
"household_type_over_65_in_households",
"household_type_over_65_in_households_family",
"M_65_in_households_nonfamily_householder_total",
"M_65_in_households_nonfamily_householder_alone",
"M_65_in_households_nonfamily_householder_not_alone",
"F_65_in_households_nonfamily_householder_total",
"F_65_in_households_nonfamily_householder_alone",
"F_65_in_households_nonfamily_householder_not_alone",
"over_65_group_quarters",
"state",
"county",
"tract"
)
#ACSpop <- ACSpop %>% gather(2:5,key = variable, value = value)
return(ACSpop)
}
counties<-unique(xwalk$COUNTY)
house_type_65_list<-list()
for (i in 1:length(counties)) {
house_type_65_list[[i]]<-getTractHouseholdType65(state = 06,county = counties[i])
}
house_type_65_df = do.call(rbind, house_type_65_list)
join_df<-dplyr::right_join(race_df, pop_dens_df) %>%
right_join(.,med_inc_df) %>%
right_join(.,house_type_65_df)
View(join_df)
View(hisp_lat_race_df)
View(hisp_lat_race_df)
join_df<-dplyr::right_join(race_df, pop_dens_df) %>%
right_join(.,med_inc_df) %>%
right_join(.,house_type_65_df) %>%
right_join(., hisp_lat_race_df)
View(join_df)
census_df<-join_df[,c(12:14, 1:11, 15:26,27,28,38)]
View(census_df)
census_df$county<-as.character(census_df$county)
census_df$county<-as.factor(census_df$county)
county_names<-read.csv("county_names.csv", header=TRUE)
county_names<-county_names[,-3]
colnames(county_names)[1]<-"county"
county_names[,1]<-as.factor(county_names[,1])
library(stringr)
county_names[,1]<-str_pad(county_names[,1], 3, pad = "0")
county_names[,1]<-as.factor(county_names[,1])
census_df<- dplyr::right_join(census_df, county_names, by="county")
View(census_df)
census_df<-census_df[,c(1:3, 30, 4:29)]
saveRDS(census_df, "census_tract_CA_heat.rds")
x<-readRDS("census_tract_CA_heat.rds")
df<-readRDS("census_tract_CA_heat.rds")
xwalk<-read.csv("Tract_UR_key.csv", header=TRUE)
df$ct9<-paste(df$county, df$tract, sep='')
library(stringr)
xwalk$ct9<-str_pad(xwalk$ct9, 9, pad="0")
df <- xwalk %>%
dplyr::select(ct9 ,MSSAdef, NCHS_2013code,NCHS_2006code, NCHS_1990basedcode,NCHS2013_text) %>%
right_join(df, by="ct9")
colnames(df)[22]<-"population"
View(df)
###aggregating be regions in the
##Knowlton et al. paper
##central_coast: Alameda, Contra Costa, Monterey, San Benito, San Francisco, San Luis Obispo, San Mateo, Santa Clara, Santa Cruz
df<- df %>% mutate( kn_region = ifelse(county_name %in% c("Alameda", "Contra Costa", "Monterey", "San Benito", "San Francisco",
"San Luis Obispo", "San Mateo", "Santa Clara", "Santa Cruz"),
"central_coast",
ifelse(county_name %in% c("Amador", "Calaveras", "Fresno", "Kern", "Kings", "Madera", "Mariposa", "Merced", "Placer", "Sacramento", "San Joaquin", "Stanislaus", "Tulare", "Tuolumne"),
"central_valley",
ifelse(county_name %in% c("Alpine", "Butte", "Colusa", "El Dorado",
"Glenn", "Lassen", "Modoc", "Mono", "Nevada", "Plumas", "Shasta", "Sierra", "Siskiyou", "Sutter", "Tehama", "Yolo", "Yuba"),
"north_central",
ifelse(county_name %in% c("Del Norte", "Humboldt", "Lake", "Marin", "Mendocino", "Napa", "Solano", "Sonoma",
"Trinity"),
"north_coast",
ifelse(county_name %in% c("Los Angeles", "Orange", "San Diego", "Santa Barbara", "Ventura"),
"south_coast",
ifelse(county_name %in% c("Imperial", "Inyo", "Riverside", "San Bernardino"),
"southeast_dessert",
"none")))))))
df$kn_region<-as.factor(df$kn_region)
View(df)
df[12:36] <- sapply(df[12:36],as.character)
df[12:36] <- sapply(df[12:36],as.numeric)
df$over_65_living_alone<-df$F_65_in_households_nonfamily_householder_alone+df$M_65_in_households_nonfamily_householder_alone
View(df)
###calculate race proportions
df$prop.white<-df$white_alone/df$race_total
df$prop.af.am<-df$black_af_am_alone/df$race_total
df$prop.asian<-df$asian_alone/df$race_total
df$prop.am.ind<-df$am_ind_alone/df$race_total
df$prop.nat.haw<-df$nat_haw_pac_isl/df$race_total
df$prop.hisp.lat<-df$yes_hisp_lat_total/df$hisp_lat_race_total
df %>%
ggplot() +
geom_histogram(aes(yes_hisp_lat_total), fill="darkseagreen4",alpha=.5) +
theme_minimal() +
xlim(0,1000) +
ylim(0,400) +
facet_wrap(~ kn_region)
df %>%
ggplot() +
geom_histogram(aes(prop.hisp.lat), fill="darkseagreen4",alpha=.5) +
theme_minimal() +
xlim(0,1000) +
ylim(0,400) +
facet_wrap(~ kn_region)
df %>%
ggplot() +
geom_histogram(aes(yes_hisp_lat_total), fill="darkseagreen4",alpha=.5) +
theme_minimal() +
xlim(0,1000) +
ylim(0,400) +
facet_wrap(~ kn_region)
df %>%
ggplot() +
geom_histogram(aes(prop.hisp.lat), fill="darkseagreen4",alpha=.5) +
theme_minimal() +
facet_wrap(~ kn_region)
df<-readRDS("census_tract_CA_heat.rds")
xwalk<-read.csv("Tract_UR_key.csv", header=TRUE)
df$ct9<-paste(df$county, df$tract, sep='')
library(stringr)
xwalk$ct9<-str_pad(xwalk$ct9, 9, pad="0")
df <- xwalk %>%
dplyr::select(ct9 ,MSSAdef, NCHS_2013code,NCHS_2006code, NCHS_1990basedcode,NCHS2013_text) %>%
right_join(df, by="ct9")
colnames(df)[22]<-"population"
###aggregating be regions in the
##Knowlton et al. paper
##central_coast: Alameda, Contra Costa, Monterey, San Benito, San Francisco, San Luis Obispo, San Mateo, Santa Clara, Santa Cruz
df<- df %>% mutate( kn_region = ifelse(county_name %in% c("Alameda", "Contra Costa", "Monterey", "San Benito", "San Francisco",
"San Luis Obispo", "San Mateo", "Santa Clara", "Santa Cruz"),
"central_coast",
ifelse(county_name %in% c("Amador", "Calaveras", "Fresno", "Kern", "Kings", "Madera", "Mariposa", "Merced", "Placer", "Sacramento", "San Joaquin", "Stanislaus", "Tulare", "Tuolumne"),
"central_valley",
ifelse(county_name %in% c("Alpine", "Butte", "Colusa", "El Dorado",
"Glenn", "Lassen", "Modoc", "Mono", "Nevada", "Plumas", "Shasta", "Sierra", "Siskiyou", "Sutter", "Tehama", "Yolo", "Yuba"),
"north_central",
ifelse(county_name %in% c("Del Norte", "Humboldt", "Lake", "Marin", "Mendocino", "Napa", "Solano", "Sonoma",
"Trinity"),
"north_coast",
ifelse(county_name %in% c("Los Angeles", "Orange", "San Diego", "Santa Barbara", "Ventura"),
"south_coast",
ifelse(county_name %in% c("Imperial", "Inyo", "Riverside", "San Bernardino"),
"southeast_dessert",
"none")))))))
df$kn_region<-as.factor(df$kn_region)
df[12:36] <- sapply(df[12:36],as.character)
df[12:36] <- sapply(df[12:36],as.numeric)
df$over_65_living_alone<-df$F_65_in_households_nonfamily_householder_alone+df$M_65_in_households_nonfamily_householder_alone
###calculate race proportions
df$prop.white<-df$white_alone/df$race_total
df$prop.af.am<-df$black_af_am_alone/df$race_total
df$prop.asian<-df$asian_alone/df$race_total
df$prop.am.ind<-df$am_ind_alone/df$race_total
df$prop.nat.haw<-df$nat_haw_pac_isl/df$race_total
df$prop.hisp.lat<-df$yes_hisp_lat_total/df$hisp_lat_race_total
library(dplyr)
df %>%
ggplot(aes(median_household_income)) +
geom_histogram( fill="darkturquoise", alpha=.5) +
theme_minimal() +
facet_wrap(~ kn_region)
df %>%
ggplot(aes(population)) +
geom_histogram(fill="violet", alpha=.5) +
theme_minimal() +
xlim(0,20000) +
facet_wrap(~ kn_region)
df %>%
ggplot() +
geom_histogram(aes(white_alone), fill="darkturquoise", alpha=.5) +
theme_minimal() +
xlim(0,15000) +
facet_wrap(~ kn_region)
df %>%
ggplot() +
geom_histogram(aes(prop.white), fill="darkturquoise", alpha=.5) +
theme_minimal() +
xlim(0,15000) +
facet_wrap(~ kn_region)
df %>%
ggplot() +
geom_histogram(aes(black_af_am_alone), fill="violet",alpha=.5) +
theme_minimal() +
xlim(0,6000) +
ylim(0,1250) +
facet_wrap(~ kn_region)
df %>%
ggplot() +
geom_histogram(aes(prop.af.am), fill="violet",alpha=.5) +
theme_minimal() +
xlim(0,6000) +
ylim(0,1250) +
facet_wrap(~ kn_region)
df %>%
ggplot() +
geom_histogram(aes(am_ind_alone), fill="slateblue1",alpha=.5) +
theme_minimal() +
xlim(0,500) +
ylim(0,1000) +
facet_wrap(~ kn_region)
df %>%
ggplot() +
geom_histogram(aes(prop.am.ind), fill="slateblue1",alpha=.5) +
theme_minimal() +
xlim(0,500) +
ylim(0,1000) +
facet_wrap(~ kn_region)
df %>%
ggplot() +
geom_histogram(aes(asian_alone), fill="palevioletred1",alpha=.5) +
theme_minimal() +
xlim(0,7000) +
ylim(0,1500) +
facet_wrap(~ kn_region)
df %>%
ggplot() +
geom_histogram(aes(prop.asian), fill="palevioletred1",alpha=.5) +
theme_minimal() +
xlim(0,7000) +
ylim(0,1500) +
facet_wrap(~ kn_region)
df %>%
ggplot() +
geom_histogram(aes(nat_haw_pac_isl), fill="darkseagreen4",alpha=.5) +
theme_minimal() +
xlim(0,1000) +
ylim(0,400) +
facet_wrap(~ kn_region)
df %>%
ggplot() +
geom_histogram(aes(prop.nat.haw), fill="darkseagreen4",alpha=.5) +
theme_minimal() +
xlim(0,1000) +
ylim(0,400) +
facet_wrap(~ kn_region)
df %>%
ggplot() +
geom_histogram(aes(yes_hisp_lat_total), fill="darkseagreen4",alpha=.5) +
theme_minimal() +
xlim(0,1000) +
ylim(0,400) +
facet_wrap(~ kn_region)
df %>%
ggplot() +
geom_histogram(aes(prop.hisp.lat), fill="darkseagreen4",alpha=.5) +
theme_minimal() +
facet_wrap(~ kn_region)
df.urban.rural<-df %>% group_by(kn_region, MSSAdef) %>%
tally()
df.urban.rural.pop<-df %>% dplyr::group_by(kn_region, MSSAdef) %>% dplyr::summarise(population_sum=sum(population, na.rm=TRUE))
df.urban.rural.pop %>%
ggplot() +
geom_bar(mapping = aes(x=MSSAdef,y = population_sum, fill=MSSAdef), stat = "identity") +
theme_minimal()+
facet_wrap(~kn_region)
df %>%
ggplot() +
geom_histogram(aes(over_65_living_alone), fill="darkturquoise", alpha=.5) +
theme_minimal() +
xlim(0,15000) + ylim(0,500)+
facet_wrap(~ kn_region)
df<-readRDS("census_tract_CA_heat.rds")
xwalk<-read.csv("Tract_UR_key.csv", header=TRUE)
df$ct9<-paste(df$county, df$tract, sep='')
library(stringr)
xwalk$ct9<-str_pad(xwalk$ct9, 9, pad="0")
df <- xwalk %>%
dplyr::select(ct9 ,MSSAdef, NCHS_2013code,NCHS_2006code, NCHS_1990basedcode,NCHS2013_text) %>%
right_join(df, by="ct9")
colnames(df)[22]<-"population"
###aggregating be regions in the
##Knowlton et al. paper
##central_coast: Alameda, Contra Costa, Monterey, San Benito, San Francisco, San Luis Obispo, San Mateo, Santa Clara, Santa Cruz
df<- df %>% mutate( kn_region = ifelse(county_name %in% c("Alameda", "Contra Costa", "Monterey", "San Benito", "San Francisco",
"San Luis Obispo", "San Mateo", "Santa Clara", "Santa Cruz"),
"central_coast",
ifelse(county_name %in% c("Amador", "Calaveras", "Fresno", "Kern", "Kings", "Madera", "Mariposa", "Merced", "Placer", "Sacramento", "San Joaquin", "Stanislaus", "Tulare", "Tuolumne"),
"central_valley",
ifelse(county_name %in% c("Alpine", "Butte", "Colusa", "El Dorado",
"Glenn", "Lassen", "Modoc", "Mono", "Nevada", "Plumas", "Shasta", "Sierra", "Siskiyou", "Sutter", "Tehama", "Yolo", "Yuba"),
"north_central",
ifelse(county_name %in% c("Del Norte", "Humboldt", "Lake", "Marin", "Mendocino", "Napa", "Solano", "Sonoma",
"Trinity"),
"north_coast",
ifelse(county_name %in% c("Los Angeles", "Orange", "San Diego", "Santa Barbara", "Ventura"),
"south_coast",
ifelse(county_name %in% c("Imperial", "Inyo", "Riverside", "San Bernardino"),
"southeast_dessert",
"none")))))))
df$kn_region<-as.factor(df$kn_region)
df[12:36] <- sapply(df[12:36],as.character)
df[12:36] <- sapply(df[12:36],as.numeric)
df$over_65_living_alone<-df$F_65_in_households_nonfamily_householder_alone+df$M_65_in_households_nonfamily_householder_alone
###calculate race proportions
df$prop.white<-df$white_alone/df$race_total
df$prop.af.am<-df$black_af_am_alone/df$race_total
df$prop.asian<-df$asian_alone/df$race_total
df$prop.am.ind<-df$am_ind_alone/df$race_total
df$prop.nat.haw<-df$nat_haw_pac_isl/df$race_total
df$prop.hisp.lat<-df$yes_hisp_lat_total/df$hisp_lat_race_total
library(dplyr)
df %>%
ggplot(aes(median_household_income)) +
geom_histogram( fill="darkturquoise", alpha=.5) +
theme_minimal() +
facet_wrap(~ kn_region)
df %>%
ggplot(aes(population)) +
geom_histogram(fill="violet", alpha=.5) +
theme_minimal() +
xlim(0,20000) +
facet_wrap(~ kn_region)
df %>%
ggplot() +
geom_histogram(aes(white_alone), fill="darkturquoise", alpha=.5) +
theme_minimal() +
xlim(0,15000) +
facet_wrap(~ kn_region)
df %>%
ggplot() +
geom_histogram(aes(prop.white), fill="darkturquoise", alpha=.5) +
theme_minimal() +
facet_wrap(~ kn_region)
df %>%
ggplot() +
geom_histogram(aes(black_af_am_alone), fill="violet",alpha=.5) +
theme_minimal() +
xlim(0,6000) +
ylim(0,1250) +
facet_wrap(~ kn_region)
df %>%
ggplot() +
geom_histogram(aes(prop.af.am), fill="violet",alpha=.5) +
theme_minimal() +
facet_wrap(~ kn_region)
df %>%
ggplot() +
geom_histogram(aes(am_ind_alone), fill="slateblue1",alpha=.5) +
theme_minimal() +
xlim(0,500) +
ylim(0,1000) +
facet_wrap(~ kn_region)
df %>%
ggplot() +
geom_histogram(aes(prop.am.ind), fill="slateblue1",alpha=.5) +
theme_minimal() +
facet_wrap(~ kn_region)
df %>%
ggplot() +
geom_histogram(aes(asian_alone), fill="palevioletred1",alpha=.5) +
theme_minimal() +
xlim(0,7000) +
ylim(0,1500) +
facet_wrap(~ kn_region)
df %>%
ggplot() +
geom_histogram(aes(prop.asian), fill="palevioletred1",alpha=.5) +
theme_minimal() +
facet_wrap(~ kn_region)
df %>%
ggplot() +
geom_histogram(aes(nat_haw_pac_isl), fill="darkseagreen4",alpha=.5) +
theme_minimal() +
xlim(0,1000) +
ylim(0,400) +
facet_wrap(~ kn_region)
df %>%
ggplot() +
geom_histogram(aes(prop.nat.haw), fill="darkseagreen4",alpha=.5) +
theme_minimal() +
facet_wrap(~ kn_region)
df %>%
ggplot() +
geom_histogram(aes(yes_hisp_lat_total), fill="darkseagreen4",alpha=.5) +
theme_minimal() +
xlim(0,1000) +
ylim(0,400) +
facet_wrap(~ kn_region)
df %>%
ggplot() +
geom_histogram(aes(prop.hisp.lat), fill="darkseagreen4",alpha=.5) +
theme_minimal() +
facet_wrap(~ kn_region)
df.urban.rural<-df %>% group_by(kn_region, MSSAdef) %>%
tally()
df.urban.rural.pop<-df %>% dplyr::group_by(kn_region, MSSAdef) %>% dplyr::summarise(population_sum=sum(population, na.rm=TRUE))
df.urban.rural.pop %>%
ggplot() +
geom_bar(mapping = aes(x=MSSAdef,y = population_sum, fill=MSSAdef), stat = "identity") +
theme_minimal()+
facet_wrap(~kn_region)
df %>%
ggplot() +
geom_histogram(aes(over_65_living_alone), fill="darkturquoise", alpha=.5) +
theme_minimal() +
xlim(0,15000) + ylim(0,500)+
facet_wrap(~ kn_region)
df %>%
ggplot() +
geom_histogram(aes(over_65_living_alone), fill="darkturquoise", alpha=.5) +
theme_minimal() +
facet_wrap(~ kn_region)
